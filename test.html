<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EPICK STREAM</title>

    <!-- Plyr CSS CDN-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/plyr@3/dist/plyr.css">

    <style>
        .container {
            display: flex;
            justify-content: center;
            align-items: center;
            max-width: max-content;
            height: auto;
            margin: auto;
            position: relative;
        }

        video {
            height: 50vh !important;
        }
    </style>
</head>

<body>

    <div class="container">
        <video id="videoPlayer" controls crossorigin playsinline>

            <source type="application/x-mpegURL" src="https://bitdash-a.akamaihd.net/content/sintel/hls/playlist.m3u8">
        </video>


    </div>

    <script src="https://cdn.jsdelivr.net/npm/hls.js@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/plyr@3"></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const video = document.getElementById("videoPlayer");
            const source = video.getElementsByTagName("source")[0].src;

            // Plyr options
            const defaultOptions = {
                controls: ['play', 'progress', 'current-time', 'mute', 'volume', 'settings', 'fullscreen'],
                settings: ['quality'],
                quality: {
                    default: 720, // Default quality
                    options: [],  // Options populated later based on HLS manifest
                    onChange: (newQuality) => updateQuality(newQuality)
                },
            };

            if (Hls.isSupported()) {
                const hls = new Hls();
                hls.loadSource(source);

                hls.on(Hls.Events.MANIFEST_PARSED, (event, data) => {
                    const availableQualities = hls.levels.map(level => level.height);
                    defaultOptions.quality.options = availableQualities;

                    // Initial player
                    const player = new Plyr(video, defaultOptions);


                    function updateQuality(newQuality) {
                        const levelIndex = hls.levels.findIndex(level => level.height === newQuality);
                        if (levelIndex !== -1) {
                            hls.currentLevel = levelIndex;
                        }
                    }

                    player.on('qualitychange', event => updateQuality(event.detail));
                });

                hls.attachMedia(video);
                window.hls = hls;
            } else {
                const player = new Plyr(video, defaultOptions);
            }
        });
    </script>

</body>

</html>